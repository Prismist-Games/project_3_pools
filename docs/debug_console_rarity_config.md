# 调试控制台品质概率配置功能说明

## 功能概述

在调试控制台中新增了两个配置区域：
1. **订单品质概率** - 控制订单需求物品的品质分布
2. **抽取品质概率** - 控制奖池抽取时物品的品质分布

## 使用方法

### 1. 打开调试控制台
- 调试控制台默认位于游戏界面右侧
- 按 `ESC` 键可以关闭控制台（如果已打开）

### 2. 修改订单品质概率
在"订单品质概率"区域中，有5个品质等级的权重输入框：
- **普通** (Common)
- **优秀** (Uncommon)
- **稀有** (Rare)
- **史诗** (Epic)
- **传说** (Legendary)

修改这些权重值会实时影响新生成订单的品质要求。

**示例配置：**
- 全是普通品质：`普通=100, 其他=0`
- 平均分布：`所有品质=100`
- 高品质倾向：`普通=10, 优秀=20, 稀有=30, 史诗=40, 传说=50`

### 3. 修改抽取品质概率
在"抽取品质概率"区域中，同样有5个品质等级的权重输入框。

修改这些权重值会实时影响从奖池抽取物品的品质分布。

**示例配置：**
- 只出传说：`普通=0, 优秀=0, 稀有=0, 史诗=0, 传说=100`
- 波动模式：`普通=50, 优秀=0, 稀有=0, 史诗=0, 传说=50`
- 渐进模式：`普通=5, 优秀=10, 稀有=20, 史诗=30, 传说=35`

### 4. 应用更改
- 权重修改会**实时应用**到当前阶段数据
- 点击**"立即应用更改"**按钮会刷新所有订单和奖池，使用新的概率配置

## 技术说明

### 概率计算原理
品质概率基于权重分配系统：
- 最终概率 = 单个品质权重 / 所有品质权重总和
- 例如：普通=100, 优秀=50, 其他=0
  - 普通概率 = 100 / (100+50) = 66.7%
  - 优秀概率 = 50 / (100+50) = 33.3%

### 权重范围
- 最小值：0.0
- 最大值：1000.0
- 步长：0.1
- 支持超出范围的手动输入

### 数据持久化
- 权重修改仅影响当前游戏会话的 `MainlineStageData`
- 重新启动游戏后，权重会恢复到原始配置文件（.tres）中的值
- 如需永久修改，请直接编辑 `res://data/mainline/stages/stage_X.tres` 文件

## 调试建议

### 测试高品质掉落
```
订单品质概率：普通=0, 优秀=0, 稀有=0, 史诗=50, 传说=50
抽取品质概率：普通=0, 优秀=0, 稀有=0, 史诗=50, 传说=50
```
点击"立即应用更改"，然后进行抽奖和订单刷新。

### 测试低品质磨练
```
订单品质概率：普通=100, 其他=0
抽取品质概率：普通=80, 优秀=20, 其他=0
```
适合测试大量物品合成和回收功能。

### 测试平衡分布
```
所有品质权重 = 100
```
模拟均衡的游戏体验。

## 注意事项

1. **神话品质** (Mythic) 不在普通概率配置中，仅通过主线池特殊机制产出
2. 修改概率不会影响已经生成的订单和物品，只影响新生成的内容
3. 将所有权重设为0会导致默认行为（通常选择第一个品质）
4. 建议在测试前备份游戏存档（如果有存档系统）

## 相关文件

- 调试控制台脚本：`scripts/ui/debug_console_ui.gd`
- 调试控制台场景：`scenes/ui/debug_console.tscn`
- 阶段数据资源：`scripts/resources/mainline_stage_data.gd`
- 订单系统：`scripts/systems/order_system.gd`
- 奖池系统：`scripts/systems/pool_system.gd`
