# 物品选中状态清除机制

## 问题描述

之前的实现中,物品的选中状态(`InventorySystem.selected_slot_index`)在一些与整理无关的操作发生时没有被自动清除,导致用户在进行新操作时还保留着旧的选中状态,造成混淆。

## 解决方案

在以下关键入口点统一清除选中状态:

### 1. **新物品进入待定队列** 
- **文件**: `scripts/systems/inventory_system.gd`
- **位置**: `_on_item_obtained()` 函数
- **触发场景**: 抽奖获得物品但背包满时
- **逻辑**: 清除选中状态,因为新物品获取是与之前的整理操作无关的新上下文

### 2. **进入提交模式**
- **文件**: `scripts/ui/controllers/switch_controller.gd`
- **位置**: `_on_submit_switch_input()` 函数
- **触发场景**: 点击提交开关进入订单提交模式
- **逻辑**: 清除单项选中状态,因为提交与整理是不同操作

### 3. **进入批量回收模式**
- **文件**: `scripts/ui/controllers/switch_controller.gd`
- **位置**: `_on_recycle_switch_input()` 函数
- **触发场景**: 点击回收开关进入批量回收模式
- **逻辑**: 清除单项选中状态,因为批量回收与整理是不同操作

### 4. **执行抽奖操作**
- **文件**: `scripts/ui/state/states/drawing_state.gd`
- **位置**: `draw()` 函数
- **触发场景**: 点击任意奖池开始抽奖
- **逻辑**: 清除选中状态,因为抽奖操作与整理操作是不同的上下文

### 5. **进入模态窗口**
- **文件**: `scripts/ui/state/game_2d_ui.gd`
- **位置**: `_on_modal_requested()` 函数
- **触发场景**: 技能选择、精准选择等模态窗口
- **逻辑**: 清除选中状态,因为进入模态窗口是与整理操作无关的新上下文

## 设计原则

**"上下文隔离"原则**: 
- 物品选中状态属于"整理模式"的上下文
- 当玩家切换到其他操作模式(抽奖、提交、回收等)时,应自动清除旧的选中状态
- 避免不同操作上下文之间的状态污染

## 测试验证

建议测试以下场景:
1. 选中一个物品后点击抽奖 -> 选中状态应被清除
2. 选中一个物品后点击提交 -> 选中状态应被清除
3. 选中一个物品后点击回收(进入批量模式) -> 选中状态应被清除
4. 选中一个物品后背包满了,新物品进入待定 -> 选中状态应被清除
5. 选中一个物品后触发技能选择 -> 选中状态应被清除
